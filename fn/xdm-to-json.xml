<?xml version="1.0" encoding="us-ascii"?>
<test-set xmlns="http://www.w3.org/2010/09/qt-fots-catalog" name="fn-xdm-to-json" covers-40="fn-xdm-to-json">
   <description>Tests for the xdm-to-json() function</description>
   <link type="spec" document="http://www.w3.org/TR/xpath-functions-30/"
         idref="func-xdm-to-json"/>
   
   <environment name="specimen">
      <schema uri="http://www.w3.org/XQueryTest/specimen" file="xdm-to-json/specimen.xsd" xsd-version="1.1">
         <description>A Schema with some nillable elements</description>
         <created by="Michael Kay" on="2023-05-31"/>
      </schema>
   </environment>
   
   <dependency type="spec" value="XP40+ XQ40+"/>

   <test-case name="xdm-to-json-001">
      <description> Empty sequence </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(())</test>
      <result>
         <assert-string-value>null</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-002">
      <description> Single string </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json("today")</test>
      <result>
         <assert-string-value>"today"</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-003">
      <description> Single number </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(23)</test>
      <result>
         <assert-string-value>23</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-004">
      <description> Single boolean </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(true())</test>
      <result>
         <assert-string-value>true</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-005">
      <description> Single boolean </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(false())</test>
      <result>
         <assert-string-value>false</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-006">
      <description> Large number </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(1_000_000_000_000)</test>
      <result>
         <assert-string-value>1000000000000</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-007">
      <description> Negative number </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(-42)</test>
      <result>
         <assert-string-value>-42</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-008">
      <description> Date </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(xs:date('2023-05-28'))</test>
      <result>
         <assert-string-value>"2023-05-28"</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-009">
      <description> +INF </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(xs:double("+INF"))</test>
      <result>
         <assert-string-value>"INF"</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-010">
      <description> -INF </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(xs:double("-INF"))</test>
      <result>
         <assert-string-value>"-INF"</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-011">
      <description> NaN </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(number("not a number"))</test>
      <result>
         <assert-string-value>"NaN"</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-012">
      <description> Empty string </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json("")</test>
      <result>
         <assert-string-value>""</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-013">
      <description> Sequence of numbers </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json((1,2,3))</test>
      <result>
         <assert-string-value>[1,2,3]</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-014">
      <description> Sequence of strings </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(("a","b","c"))</test>
      <result>
         <assert-string-value>["a","b","c"]</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-015">
      <description> Sequence of booleans </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json((true(),false(),true()))</test>
      <result>
         <assert-string-value>[true,false,true]</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-016">
      <description> Array of numbers </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json([1,2,3])</test>
      <result>
         <assert-string-value>[1,2,3]</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-017">
      <description> Array of strings </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(["a","b","c"])</test>
      <result>
         <assert-string-value>["a","b","c"]</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-018">
      <description> Array of booleans </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json([true(),false(),true()])</test>
      <result>
         <assert-string-value>[true,false,true]</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-019">
      <description> Empty array </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json([])</test>
      <result>
         <assert-string-value>[]</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-020">
      <description> Singleton array </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(["a"])</test>
      <result>
         <assert-string-value>["a"]</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-021">
      <description> Map with string keys and numeric values </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(map{"a":1,"b":2})</test>
      <result>
         <any-of>
            <assert-string-value>{"a":1,"b":2}</assert-string-value>
            <assert-string-value>{"b":2,"a":1}</assert-string-value>
         </any-of>        
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-022">
      <description> Map with string keys and boolean values </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(map{"a":true(),"b":false()})</test>
      <result>
         <any-of>
            <assert-string-value>{"a":true,"b":false}</assert-string-value>
            <assert-string-value>{"b":false,"a":true}</assert-string-value>
         </any-of>        
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-023">
      <description> Map with string keys and string values </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(map{"a":"x","b":"y"})</test>
      <result>
         <any-of>
            <assert-string-value>{"a":"x","b":"y"}</assert-string-value>
            <assert-string-value>{"b":"y","a":"x"}</assert-string-value>
         </any-of>        
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-024">
      <description> Array of maps </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json([map{"a":"x"},map{"a":1},map{"a":true()}])</test>
      <result>
         <assert-string-value>[{"a":"x"},{"a":1},{"a":true}]</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-025">
      <description> Map of arrays </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(map{"a":["x","y","z"],"b":[1,2,3]})</test>
      <result>
         <any-of>
            <assert-string-value>{"a":["x","y","z"],"b":[1,2,3]}</assert-string-value> 
            <assert-string-value>{"b":[1,2,3],"a":["x","y","z"]}</assert-string-value> 
         </any-of>            
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-026">
      <description> Array of arrays </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(["x","y","z",[1,2,3,[true(),false()]]])</test>
      <result>
         <assert-string-value>["x","y","z",[1,2,3,[true,false]]]</assert-string-value>           
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-027">
      <description> Internal null </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json([1,2,3,(),(),6])</test>
      <result>
         <assert-string-value>[1,2,3,null,null,6]</assert-string-value>           
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-028">
      <description> Internal null </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(map{"a":1,"b":()})</test>
      <result>
         <any-of>
            <assert-string-value>{"a":1,"b":null}</assert-string-value> 
            <assert-string-value>{"b":null,"a":1}</assert-string-value> 
         </any-of>      
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-029">
      <description> Function reference </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(count#1)</test>
      <result>
         <assert-string-value>{"#function":{"#name":"Q{http://www.w3.org/2005/xpath-functions}count","#arity":"1"}}</assert-string-value>      
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-030">
      <description> Inline function expression </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(fn($a) { $a + 1 })</test>
      <result>
         <assert-string-value>{"#function":{"#arity":"1"}}</assert-string-value>      
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-031">
      <description> Partially applied function </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>xdm-to-json(contains(?,'e'))</test>
      <result>
         <assert-string-value>{"#function":{"#arity":"1"}}</assert-string-value>      
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-032">
      <description> Map of arrays with indentation </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>
         let $out := xdm-to-json(map{"a":["x","y","z"],"b":[1,2,3]}, map{'indent':true()})
         return map{'A':contains($out, ' '), 'B': $out => parse-json() => xdm-to-json()}
      </test>
      <result>
         <all-of>
            <assert>$result?A</assert>
            <any-of>
               <assert>$result?B = '{"a":["x","y","z"],"b":[1,2,3]}'</assert>
               <assert>$result?B = '{"b":[1,2,3],"a":["x","y","z"]}'</assert>
            </any-of>
         </all-of>            
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-033">
      <description> Array of arrays with indentation </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>
         let $out := xdm-to-json(["x","y","z",[1,2,3,[true(),false()]]], map{'indent':true()})
         return map{'A':contains($out, ' '), 'B': $out => parse-json() => xdm-to-json()}
      </test>
      <result>
         <all-of>
            <assert>$result?A</assert>
            <assert>$result?B = '["x","y","z",[1,2,3,[true,false]]]'</assert>
         </all-of>          
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-034">
      <description> Solidus is escaped </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>
         xdm-to-json(["and/or","http://ibm.com"], map{'escape-solidus':true()})
      </test>
      <result>
         <assert-string-value>["and\/or","http:\/\/ibm.com"]</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-035">
      <description> Solidus is not escaped </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>
         xdm-to-json(["and/or","http://ibm.com"], map{'escape-solidus':false()})
      </test>
      <result>
         <assert-string-value>["and/or","http://ibm.com"]</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-036">
      <description> Solidus is not escaped </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>
         xdm-to-json(["and/or","http://ibm.com"])
      </test>
      <result>
         <assert-string-value>["and/or","http://ibm.com"]</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-037">
      <description> Solidus is escaped </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>
         xdm-to-json(map{'and/or': 'http://ibm.com'}, map{'escape-solidus':true()})
      </test>
      <result>
         <assert-string-value>{"and\/or":"http:\/\/ibm.com"}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-038">
      <description> Solidus is not escaped </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>
         xdm-to-json(map{'and/or': 'http://ibm.com'}, map{'escape-solidus':false()})
      </test>
      <result>
         <assert-string-value>{"and/or":"http://ibm.com"}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-039">
      <description> Tab and newline are escaped </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <modified by="Michael Kay" on="2024-03-25" change="the char() function has changed"/>
      <test>
         xdm-to-json(map{char(10): char(9)})
      </test>
      <result>
         <assert-string-value>{"\n":"\t"}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-040">
      <description> Backslash is escaped </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test>
         xdm-to-json(map{'\': '/'}, map{'escape-solidus':true()})
      </test>
      <result>
         <assert-string-value>{"\\":"\/"}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-104">
      <description> Text node </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[xdm-to-json(parse-xml("<a>jigsaw</a>")//text())]]></test>
      <result>
         <assert-string-value>{"#text":"jigsaw"}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-105">
      <description> Comment node </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[xdm-to-json(parse-xml("<a><!--remarkable--></a>")//comment())]]></test>
      <result>
         <assert-string-value>{"#comment":"remarkable"}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-106">
      <description> PI node </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[xdm-to-json(parse-xml("<a><?go man go?></a>")//processing-instruction())]]></test>
      <result>
         <assert-string-value>{"#processing-instruction":{"#name":"go","#data":"man go"}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-107">
      <description> attribute node </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[xdm-to-json(parse-xml("<a code='835'/>")//@*)]]></test>
      <result>
         <assert-string-value>{"@code":"835"}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-108">
      <description> namespaced attribute node </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml("<a xml:id='thing'/>")//@*)
      ]]></test>
      <result>
         <assert-string-value>{"@xml:id":"thing"}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-109">
      <description> namespaced attribute node </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml("<a p:id='thing' xmlns:p='http://p.com/'/>")//@*)
      ]]></test>
      <result>
         <assert-string-value>{"@Q{http://p.com/}id":"thing"}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-110">
      <description> numeric typed attribute node </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="atomic"/>
      <dependency type="spec" value="XQ10+"/>
      <dependency type="feature" value="schemaImport"/>
      <test>
         import schema namespace atomic="http://www.w3.org/XQueryTest"; 
         xdm-to-json(//atomic:decimal/@atomic:attr)
      </test>
      <result>
         <assert-string-value>{"@Q{http://www.w3.org/XQueryTest}attr":12678967.543233}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-111">
      <description> list typed attribute node </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="atomic"/>
      <dependency type="spec" value="XQ10+"/>
      <dependency type="feature" value="schemaImport"/>
      <test>
         import schema namespace atomic="http://www.w3.org/XQueryTest"; 
         xdm-to-json(//atomic:idrefs/@atomic:attr)
      </test>
      <result>
         <assert-string-value>{"@Q{http://www.w3.org/XQueryTest}attr":["id1","id2"]}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-112">
      <description> namespace node (namespace axis not available in XQuery) </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <dependency type="spec" value="XP40+"/>
      <test><![CDATA[
         xdm-to-json(parse-xml("<a p:id='thing' xmlns:p='http://p.com/'/>")//namespace::p)
      ]]></test>
      <result>
         <assert-string-value>{"#namespace":{"#prefix":"p","#uri":"http://p.com/"}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-112a">
      <description> namespace node (can be constructed in XQuery) </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <dependency type="spec" value="XQ40+"/>
      <test><![CDATA[
         xdm-to-json(namespace{"p"}{"http://p.com/"})
      ]]></test>
      <result>
         <assert-string-value>{"#namespace":{"#prefix":"p","#uri":"http://p.com/"}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-113">
      <description> document node - URI</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(doc('abs/e1.xml'))
      ]]></test>
      <result>
         <assert-string-value>{"#document":[{"e":"1"}]}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-114">
      <description> document node - content</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a/>'))
      ]]></test>
      <result>
         <assert-string-value>{"#document":[{"a":""}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-115">
      <description> document node - comments and whitespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<!--start--> <a/> <!--end-->'))
      ]]></test>
      <result>
         <assert-string-value>{"#document":[{"#comment":"start"},{"a":""},{"#comment":"end"}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-116">
      <description> document node - ill-formed - contains text node</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <dependency type="spec" value="XQ40+"/>
      <test><![CDATA[
         xdm-to-json(document{text{"ill-formed"}})
      ]]></test>
      <result>
         <assert-string-value>{"#document":["ill-formed"]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-200">
      <description> element node - implicit - empty</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a/>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":""}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-201">
      <description> element node - implicit - empty - whitespace significant</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a> </a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":" "}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-202">
      <description> element node - implicit - empty - default namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xmlns="http://one.com/"/>')/*:a)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://one.com/}a":""}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-203">
      <description> element node - implicit - empty - non-default namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<p:a xmlns:p="http://one.com/"/>')/*:a)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://one.com/}a":""}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-204">
      <description> element node - implicit - nested</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b/></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"b":""}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-205">
      <description> element node - implicit - nested same namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xmlns="http://one.com/"><b/></a>')/*:a)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://one.com/}a":{"b":""}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-206">
      <description> element node - implicit - nested same namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<p:a xmlns:p="http://one.com/"><p:b/></p:a>')/*:a)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://one.com/}a":{"b":""}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-207">
      <description> element node - implicit - nested different namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xmlns="http://one.com/"><b xmlns=""/></a>')/*:a)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://one.com/}a":{"Q{}b":""}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-208">
      <description> element node - implicit - nested different namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<p:a xmlns:p="http://one.com/"><b/></p:a>')/*:a)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://one.com/}a":{"Q{}b":""}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-209">
      <description> element node - implicit - nested different namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><p:b xmlns:p="http://two.com/"/></a>')/*:a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"Q{http://two.com/}b":""}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-210">
      <description> element node - implicit - empty-plus</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a x="1" y="2"/>')/a)
      ]]></test>
      <result>
         <any-of>
            <assert-string-value>{"a":{"@x":"1","@y":"2"}}</assert-string-value> 
            <assert-string-value>{"a":{"@y":"2","@x":"1"}}</assert-string-value>  
         </any-of>           
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-211">
      <description> element node - implicit - simple</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a>babel</a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":"babel"}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-212">
      <description> element node - implicit - simple - whitespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a> </a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":" "}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-220">
      <description> element node - implicit - simple plus</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="zz">babel</a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@id":"zz","#content":"babel"}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-221">
      <description> element node - implicit - simple plus</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="zz" x="22">babel</a>')/a)
      ]]></test>
      <result>
         <any-of>
            <assert-string-value>{"a":{"@id":"zz","@x":"22","#content":"babel"}}</assert-string-value> 
            <assert-string-value>{"a":{"@x":"22","@id":"zz","#content":"babel"}}</assert-string-value> 
         </any-of>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-222">
      <description> element node - implicit - simple plus - whitespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="zz" x="22"> </a>')/a)
      ]]></test>
      <result>
         <any-of>
            <assert-string-value>{"a":{"@id":"zz","@x":"22","#content":" "}}</assert-string-value> 
            <assert-string-value>{"a":{"@x":"22","@id":"zz","#content":" "}}</assert-string-value> 
         </any-of>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-223">
      <description> element node - implicit - simple plus - nested</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="aa"><b id="bb">bertie</b></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@id":"aa","b":{"@id":"bb","#content":"bertie"}}}</assert-string-value>  
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-224">
      <description> element node - implicit - simple plus - nested, different namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="aa"><b id="bb" xmlns="http://bertie.com/">bertie</b></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@id":"aa","Q{http://bertie.com/}b":{"@id":"bb","#content":"bertie"}}}</assert-string-value>  
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-225">
      <description> element node - implicit - simple plus - attribute in namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="zz" p:x="22" xmlns:p="http://p.com/">babel</a>')/a)
      ]]></test>
      <result>
         <any-of>
            <assert-string-value>{"a":{"@id":"zz","@Q{http://p.com/}x":"22","#content":"babel"}}</assert-string-value> 
            <assert-string-value>{"a":{"@Q{http://p.com/}x":"22","@id":"zz","#content":"babel"}}</assert-string-value> 
         </any-of>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-230">
      <description> element node - implicit - list-plus</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="zz"><b/><b/></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@id":"zz","b":["",""]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-231">
      <description> element node - implicit - list-plus</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xml:id="zz"><b>xxx</b><b>yyy</b><b>zzz</b></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@xml:id":"zz","b":["xxx","yyy","zzz"]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-232">
      <description> element node - implicit - list-plus</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xml:id="zz"><b><p/></b><b><q/></b><b><r/></b></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@xml:id":"zz","b":[{"p":""},{"q":""},{"r":""}]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-233">
      <description> element node - implicit - list-plus - whitespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xml:id="zz"><b> <p/> </b><b> <q/> </b><b> <r/> </b></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@xml:id":"zz","b":[{"p":""},{"q":""},{"r":""}]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-234">
      <description> element node - implicit - list-plus - same namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xmlns="http://one.com/" xml:id="zz"><b><p/></b><b><q/></b><b><r/></b></a>')/*:a)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://one.com/}a":{"@xml:id":"zz","b":[{"p":""},{"q":""},{"r":""}]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-235">
      <description> element node - implicit - list-plus - different namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xml:id="zz"><b xmlns="http://one.com/"><p/></b><b xmlns="http://one.com/"><q/></b><b xmlns="http://one.com/"><r/></b></a>')/*:a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@xml:id":"zz","Q{http://one.com/}b":[{"p":""},{"q":""},{"r":""}]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-236">
      <description> element node - implicit - list-plus - different namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xmlns="http://zero.com/" xml:id="zz"><b xmlns="http://one.com/"><p/></b><b xmlns="http://one.com/"><q/></b><b xmlns="http://one.com/"><r/></b></a>')/*:a)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://zero.com/}a":{"@xml:id":"zz","Q{http://one.com/}b":[{"p":""},{"q":""},{"r":""}]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-240">
      <description> element node - implicit - record</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xml:id="zz"><p/><q/><r/></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@xml:id":"zz","p":"","q":"","r":""}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-241">
      <description> element node - implicit - record - whitespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xml:id="zz"> <p/> <q/> <r/> </a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@xml:id":"zz","p":"","q":"","r":""}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-242">
      <description> element node - implicit - record - namespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a xml:id="zz"> <p/> <z:q xmlns:z="http://z.com/" z:id="cow"/> <r/> </a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@xml:id":"zz","p":"","Q{http://z.com/}q":{"@Q{http://z.com/}id":"cow"},"r":""}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-250">
      <description> element node - implicit - sequence</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><head/><p/><p/><p/></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"head":""},{"p":""},{"p":""},{"p":""}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-251">
      <description> element node - implicit - sequence - with attributes and content</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a diff="chg"><head/><p>Intro</p><p/><p/></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"@diff":"chg"},{"head":""},{"p":"Intro"},{"p":""},{"p":""}]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-252">
      <description> element node - implicit - sequence - with whitespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a diff="chg"> <head/> <p>Intro</p> <p/> <p/> </a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"@diff":"chg"},{"head":""},{"p":"Intro"},{"p":""},{"p":""}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-260">
      <description> element node - implicit - mixed</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><head/><p/><p/><p/>The end</a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"head":""},{"p":""},{"p":""},{"p":""},"The end"]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-261">
      <description> element node - implicit - mixed - with attributes and content</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a diff="chg"><head/>The beginning<p>Intro</p><p/><p/></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"@diff":"chg"},{"head":""},"The beginning",{"p":"Intro"},{"p":""},{"p":""}]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-262">
      <description> element node - implicit - mixed - with whitespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a diff="chg"> <head/> <p>Intro</p> The middle <p/> <p/> </a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"@diff":"chg"}," ",{"head":""}," ",{"p":"Intro"}," The middle ",{"p":""}," ",{"p":""}," "]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-263">
      <description> element node - implicit - mixed - with comment</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><head>Title</head><!--lets start--><p>Intro</p><p>Outtro</p><!--the end--></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"head":"Title"},{"#comment":"lets start"},{"p":"Intro"},{"p":"Outtro"},{"#comment":"the end"}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-264">
      <description> element node - implicit - mixed - with comments and whitespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a> <head>Title</head> Lets start <p>Intro</p> <p>Outtro</p> <!--the end--> </a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[" ",{"head":"Title"}," Lets start ",{"p":"Intro"}," ",{"p":"Outtro"}," ",{"#comment":"the end"}," "]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-270">
      <description> element node - implicit - list</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b/><b/></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":["",""]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-271">
      <description> element node - implicit - list</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b>xxx</b><b>yyy</b><b>zzz</b></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":["xxx","yyy","zzz"]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-272">
      <description> element node - implicit - list</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b><p/></b><b><q/></b><b><r/></b></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"p":""},{"q":""},{"r":""}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-273">
      <description> element node - implicit - list - whitespace</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b> <p/> </b><b> <q/> </b><b> <r/> </b></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"p":""},{"q":""},{"r":""}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-274">
      <description> element node - implicit - list - complex children</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b nr="1"><p>One</p></b><b nr="2"><p>Two</p></b><b nr="3"><p>Three</p></b></a>')/a)
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"@nr":"1","p":"One"},{"@nr":"2","p":"Two"},{"@nr":"3","p":"Three"}]}</assert-string-value> 
      </result>
   </test-case>
   
 
   
   <test-case name="xdm-to-json-300">
      <description> element node - schema-based - empty</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:Empty/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}Empty":""}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-301">
      <description> element node - schema-based - empty content, schema allows attributes, but there are none</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:EmptyPlus/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}EmptyPlus":{}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-302">
      <description> element node - schema-based - empty content, with a boolean attribute</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:EmptyPlus test="true"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}EmptyPlus":{"@test":true}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-303">
      <description> element node - schema-based - empty content, with a numeric attribute</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:EmptyPlus num="42"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}EmptyPlus":{"@num":42}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-304">
      <description> element node - schema-based - empty content, with a list-valued attribute</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:EmptyPlus list="42 43 44"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}EmptyPlus":{"@list":[42,43,44]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-305">
      <description> element node - schema-based - empty content, with a singleton list-valued attribute</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:EmptyPlus list="1234"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}EmptyPlus":{"@list":[1234]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-306">
      <description> element node - schema-based - empty content, with an empty list-valued attribute</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:EmptyPlus list=""/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}EmptyPlus":{"@list":[]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-307">
      <description> element node - schema-based - empty content, nilled</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:EmptyPlus list="" xsi:nil="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}EmptyPlus":{"@list":[]}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-310">
      <description> element node - schema-based - simple content, numeric</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:Number>5</c:Number>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}Number":5}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-311">
      <description> element node - schema-based - simple content, boolean</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:Boolean>0</c:Boolean>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}Boolean":false}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-312">
      <description> element node - schema-based - simple content, date</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:Date>2023-05-31</c:Date>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}Date":"2023-05-31"}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-313">
      <description> element node - schema-based - simple content, list of numbers</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:ListOfNumbers>33 32 31</c:ListOfNumbers>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}ListOfNumbers":[33,32,31]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-314">
      <description> element node - schema-based - simple content, singleton list of numbers</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:ListOfNumbers>33</c:ListOfNumbers>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}ListOfNumbers":[33]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-315">
      <description> element node - schema-based - simple content, empty list of numbers</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:ListOfNumbers></c:ListOfNumbers>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}ListOfNumbers":[]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-316">
      <description> element node - schema-based - simple typed content, plus attributes </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:BooleanPlus num="3" test="0">1</c:BooleanPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}BooleanPlus":{"@num":3,"@test":false,"#content":true}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-317">
      <description> element node - schema-based - simple typed content, plus attributes, nilled </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:BooleanPlus num="3" test="0" xsi:nil="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}BooleanPlus":{"@num":3,"@test":false,"#content":null}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-318">
      <description> element node - schema-based - simple typed content, plus attributes, @xsi:nil attribute is dropped </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:BooleanPlus num="3" test="0" xsi:nil="0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">1</c:BooleanPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}BooleanPlus":{"@num":3,"@test":false,"#content":true}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-320">
      <description> element node - schema-based - list layout - whitespace dropped</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:ListPlus num="5">
                                        <c:DatePlus num="1">2000-01-01</c:DatePlus>
                                        <c:DatePlus num="2">2000-01-02</c:DatePlus>
                                        <c:DatePlus num="3">2000-01-03</c:DatePlus></c:ListPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}ListPlus":{"@num":5,"DatePlus":[{"@num":1,"#content":"2000-01-01"},{"@num":2,"#content":"2000-01-02"},{"@num":3,"#content":"2000-01-03"}]}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-321">
      <description> element node - schema-based - list layout - singleton</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:ListPlus num="3">
                                        <c:DatePlus num="1">2000-01-01</c:DatePlus>
                                     </c:ListPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}ListPlus":{"@num":3,"DatePlus":[{"@num":1,"#content":"2000-01-01"}]}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-322">
      <description> element node - schema-based - list layout - empty</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:ListPlus num="3" test="0"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}ListPlus":{"@num":3,"@test":false,"DatePlus":[]}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-330">
      <description> element node - schema-based - record layout, no attributes, no repeats, whitespace </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:RecordPlus>
                                       <c:Boolean>1</c:Boolean>
                                       <c:Number>2</c:Number>
                                       <c:Date>1966-07-03</c:Date>
                                     </c:RecordPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}RecordPlus":{"Boolean":true,"Number":2,"Date":"1966-07-03"}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-331">
      <description> element node - schema-based - record layout, attributes, no repeats, whitespace </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:RecordPlus test="1">
                                       <c:Boolean>1</c:Boolean>
                                       <c:Number>2</c:Number>
                                       <c:Date>1966-07-03</c:Date>
                                     </c:RecordPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}RecordPlus":{"@test":true,"Boolean":true,"Number":2,"Date":"1966-07-03"}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-332">
      <description> element node - schema-based - record layout, attributes, repeated element, whitespace </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:RecordPlus test="1">
                                       <c:Boolean>1</c:Boolean>
                                       <c:Number>2</c:Number>
                                       <c:Date>1966-07-03</c:Date>
                                       <c:Date>1966-07-04</c:Date>
                                     </c:RecordPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}RecordPlus":{"@test":true,"Boolean":true,"Number":2,"Date[1]":"1966-07-03","Date[2]":"1966-07-04"}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-333">
      <description> element node - schema-based - record layout, repeated element, whitespace </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:RecordPlus>
                                       <c:Date>1966-07-03</c:Date>
                                       <c:Boolean>1</c:Boolean>
                                       <c:Date>1966-07-04</c:Date>
                                     </c:RecordPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}RecordPlus":{"Date[1]":"1966-07-03","Boolean":true,"Date[2]":"1966-07-04"}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-334">
      <description> element node - schema-based - record layout, nilled, no attributes </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:RecordPlus xsi:nil="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}RecordPlus":{"#content":null}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-335">
      <description> element node - schema-based - record layout, nilled, with attributes </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:RecordPlus num="42" xsi:nil="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}RecordPlus":{"@num":42,"#content":null}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-336">
      <description> element node - schema-based - record layout, empty, not nilled, attributes </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:RecordPlus num="42" xsi:nil="0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}RecordPlus":{"@num":42}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-337">
      <description> element node - schema-based - record layout, empty, not nilled, no attributes </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:RecordPlus xsi:nil="0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}RecordPlus":{}}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-340">
      <description> element node - schema-based - sequence layout, no attributes, whitespace </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:Sequence>
                                       <c:Boolean>1</c:Boolean>
                                       <c:Number>2</c:Number>
                                       <c:Date>1966-07-03</c:Date>
                                     </c:Sequence>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}Sequence":[{"Boolean":true},{"Number":2},{"Date":"1966-07-03"}]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-341">
      <description> element node - schema-based - sequence layout, attributes, whitespace </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:SequencePlus num="42">
                                       <c:BooleanPlus>1</c:BooleanPlus>
                                       <c:NumberPlus>2</c:NumberPlus>
                                       <c:DatePlus>1966-07-03</c:DatePlus>
                                     </c:SequencePlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}SequencePlus":[{"@num":42},{"BooleanPlus":{"#content":true}},{"NumberPlus":{"#content":2}},{"DatePlus":{"#content":"1966-07-03"}}]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-342">
      <description> element node - schema-based - sequence layout, nilled </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:SequencePlus num="42" xsi:nil="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}SequencePlus":[{"@num":42},null]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-350">
      <description> element node - schema-based - mixed layout, whitespace, no attributes </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:Mixed>A can of <c:Number>2</c:Number>  <c:Date>1966-07-03</c:Date> worms</c:Mixed>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}Mixed":["A can of ",{"Number":2},"  ",{"Date":"1966-07-03"}," worms"]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-351">
      <description> element node - schema-based - mixed layout, whitespace, attributes </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:MixedPlus test="0">A can of <c:Number>2</c:Number>  <c:Date>1966-07-03</c:Date> worms</c:MixedPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}MixedPlus":[{"@test":false},"A can of ",{"Number":2},"  ",{"Date":"1966-07-03"}," worms"]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-352">
      <description> element node - schema-based - mixed layout, whitespace, attributes, nilled </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:MixedPlus test="0" xsi:nil="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"/>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}MixedPlus":[{"@test":false},null]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-353">
      <description> element node - schema-based - mixed layout, whitespace, attributes, not nilled </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:MixedPlus test="0" xsi:nil="0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            >A can of <c:Number>2</c:Number>  <c:Date>1966-07-03</c:Date> worms</c:MixedPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}MixedPlus":[{"@test":false},"A can of ",{"Number":2},"  ",{"Date":"1966-07-03"}," worms"]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-354">
      <description> element node - schema-based - mixed layout, whitespace, attributes, comments and PIs </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         declare boundary-space preserve;
         let $in := validate strict {<c:MixedPlus test="0">A can of <!--many-->  <c:Date>1966-07-03</c:Date> <?pi worms?></c:MixedPlus>}
         return xdm-to-json($in)
      ]]></test>
      <result>
         <assert-string-value>{"Q{http://www.w3.org/XQueryTest/specimen}MixedPlus":[{"@test":false},"A can of ",{"#comment":"many"},"  ",{"Date":"1966-07-03"}," ",{"#processing-instruction":{"#name":"pi","#data":"worms"}}]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-400">
      <description> element node - explicit - selects empty layout though not empty</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="3"/>')/a, map{'layouts':map{QName('','a'):'empty'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":""}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-401">
      <description> element node - explicit - selects empty layout though not empty</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="3"><b/></a>')/a, map{'layouts':map{QName('','a'):'empty'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":""}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-402">
      <description> element node - explicit - selects empty-plus layout though there are no attributes</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a/>')/a, map{'layouts':map{QName('','a'):'empty-plus'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":{}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-403">
      <description> element node - explicit - selects empty-plus layout though there are children</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b/></a>')/a, map{'layouts':map{QName('','a'):'empty-plus'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":{}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-410">
      <description> element node - explicit - selects simple layout though there is mixed content</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a>The <i>short</i> introduction</a>')/a, map{'layouts':map{QName('','a'):'simple'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":"The short introduction"}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-411">
      <description> element node - explicit - selects simple-plus layout though there are no attributes</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a>The <i>short</i> introduction</a>')/a, map{'layouts':map{QName('','a'):'simple-plus'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":{"#content":"The short introduction"}}</assert-string-value>     
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-412">
      <description> element node - schema-based - request simple layout, but content cannot be atomized</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <environment ref="specimen"/>
      <dependency type="spec" value="XQ40+"/>
      <dependency type="xsd-version" value="1.1"/>
      <test><![CDATA[
         import schema namespace c="http://www.w3.org/XQueryTest/specimen";
         let $in := validate strict {<c:Sequence><c:Boolean>1</c:Boolean><c:Number>2</c:Number></c:Sequence>}
         return xdm-to-json($in, map{'layouts':map{QName('http://www.w3.org/XQueryTest/specimen','Sequence'):'simple'}})
      ]]></test>
      <result>
         <error code="FOTY0012"/> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-420">
      <description> element node - request list format though element names are inconsistent. Fall back to mixed.</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="zz"><b/><b/><c/></a>')/a, map{'layouts':map{QName('','a'):'list'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"@id":"zz"},{"b":""},{"b":""},{"c":""}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-421">
      <description> element node - request list format though there are text node children. Fall back to mixed. </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="zz"><b/>rhubarb<b/></a>')/a, map{'layouts':map{QName('','a'):'list'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"@id":"zz"},{"b":""},"rhubarb",{"b":""}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-422">
      <description> element node - request list format though there are attributes. Drop the attributes. </description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="zz"><b>one</b><b>two</b></a>')/a, map{'layouts':map{QName('','a'):'list'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":["one","two"]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-430">
      <description> element node - select record format though element names repeat</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="zz"><b/><b/><c/></a>')/a, map{'layouts':map{QName('','a'):'record'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@id":"zz","b[1]":"","b[2]":"","c":""}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-431">
      <description> element node - select record layout though element names repeat, nested</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a id="zz"><b><p/></b><b><p/><p/></b></a>')/a, map{'layouts':map{QName('','a'):'record',QName('','b'):'record'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":{"@id":"zz","b[1]":{"p":""},"b[2]":{"p[1]":"","p[2]":""}}}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-440">
      <description> element node - select mixed/simple layout though there is no non-whitespace text</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b> </b> <b>_</b></a>')/a, map{'layouts':map{QName('','a'):'mixed',QName('','b'):'simple'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"b":" "}," ",{"b":"_"}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-500">
      <description> element node - uniform across empty and empty-plus elements</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b/><b id="x"/><b/><c/></a>')/a, map{'uniform':true()})
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"b":{}},{"b":{"@id":"x"}},{"b":{}},{"c":""}]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-501">
      <description> element node - uniform across simple and empty-plus elements</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b>-</b><b id="x"/><b>+</b><c/></a>')/a, map{'uniform':true()})
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"b":{"#content":"-"}},{"b":{"@id":"x","#content":""}},{"b":{"#content":"+"}},{"c":""}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-502">
      <description> element node - uniform across list and single-child and empty elements</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b></b><b><i/><i/><i/></b><b><i/></b></a>')/a, map{'uniform':true(),'layouts':map{QName('','b'):'list-plus'}})
      ]]></test>
      <result>
         <assert-string-value>{"a":[[],{"i":["","",""]},[{"i":""}]]}</assert-string-value>
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-503">
      <description> element node - uniform across lists with different child elements</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b></b><b><j/><j/><j/></b><b><i/></b></a>')/a, map{'uniform':true()})
      ]]></test>
      <result>
         <assert-string-value>{"a":[[],["","",""],[""]]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-504">
      <description> element node - uniform across list and list-plus elements</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b id="x"></b><b><i/><i/><i/></b><b><i/></b><c/></a>')/a, map{'uniform':true()})
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"b":{"@id":"x","i":[]}},{"b":{"i":["","",""]}},{"b":{"i":[""]}},{"c":""}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-505">
      <description> element node - uniform across list and record elements</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b><i/><j/><k/></b><b><i/><i/><i/></b><c/></a>')/a, map{'uniform':true()})
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"b":{"i":"","j":"","k":""}},{"b":{"i[1]":"","i[2]":"","i[3]":""}},{"c":""}]}</assert-string-value> 
      </result>
   </test-case>
   
   <test-case name="xdm-to-json-506">
      <description> element node - uniform across list and mixed elements</description>
      <created by="Michael Kay" on="2023-05-28"/>
      <test><![CDATA[
         xdm-to-json(parse-xml('<a><b><i/><j/>zzz<k/></b><b><i/><i/><i/></b><c/></a>')/a, map{'uniform':true()})
      ]]></test>
      <result>
         <assert-string-value>{"a":[{"b":[{"i":""},{"j":""},"zzz",{"k":""}]},{"b":[{"i":""},{"i":""},{"i":""}]},{"c":""}]}</assert-string-value>
      </result>
   </test-case>
   
   
   
   
   
</test-set>
   

 